!function($){var modal=$("#ajax-modal"),links=[{bgcolor:"#3F51B5",icon:"+",id:"gButton"},{id:"btTodoForm",bgcolor:"#00ACEE",color:"#fffff",icon:"<i class='fa fa-pencil'></i>",title:"Cadastrar nova tarefa"},{url:"/home",bgcolor:"#263238",color:"white",icon:"<i class='fa fa-home'></i>",title:"Voltar para página inicial"}];$("#todo_menu").kc_fab(links),$("#btTodoForm").on("mousedown",function(event){$("body").modalmanager("loading"),modal.load("todo/form","",function(){modal.modal()})}),modal.on("mousedown",".bt-close",function(){location.reload()});var save=!0;modal.on("mousedown","#btSalvar",function(){if(save){var title=$("#todo_title"),id=$("#userId");title.val()&&$.post("todo/p",{title:title.val(),user_id:id.val()},function(data){var html='<div class="panel panel-success"><div class="panel-heading"><h3 class="panel-title">'+data.message+'</h3></div><div class="panel-body"><p>Identificador: '+data.id+"</p><p>Titulo: "+data.title+"</p></div></div>";$(".retorno").html(html)}).fail(function(data){$(".retorno").html('<div class="alert alert-danger">Erro: ['+data.status+"] "+data.statusText+": "+data.responseJSON+"</div>")}).always(function(){$(".retorno").removeClass("hidden").fadeIn("slow"),save=!1})}else $(".retorno").html('<div class="alert alert-warning">Edite o campo antes de salvar.</div>')}),modal.on("keydown","#todo_title",function(){$(".retorno").addClass("hidden").fadeOut("slow"),save=!0})}(jQuery),function(angular){angular.module("todo",["ngSanitize","ngMaterial","ngAnimate","ui.grid","ui.grid.selection","ui.grid.edit","ui.grid.exporter","ui.grid.cellNav","ui.grid.validate"]).controller("TodoGridController",["$scope","i18nService","$http","uiGridConstants",function($scope,i18nService,$http,uiGridConstants){$scope.alertaErro=!0,$scope.alertaEdicao=!0,$scope.alertaExclusao=!0,i18nService.setCurrentLang("pt-br"),$scope.gridOptions={enableCellEditOnFocus:!0,multiSelect:!0,noUnselect:!0,enableRowSelection:!0,enableFiltering:!0,showGridFooter:!0,enableGridMenu:!0,exporterCsvFilename:"todo.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[30,30,30,30]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"Tarefas",style:"headerStyle"},exporterPdfFooter:function(currentPage,pageCount){return{text:currentPage.toString()+" de "+pageCount.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(docDefinition){return docDefinition.styles.headerStyle={fontSize:22,bold:!0},docDefinition.styles.footerStyle={fontSize:10,bold:!0},docDefinition},exporterPdfOrientation:"landscape",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),exporterFieldCallback:function(grid,row,col,input){return input},onRegisterApi:function(gridApi){$scope.gridApi=gridApi}},$scope.gridOptions.columnDefs=[{name:"id",displayName:"Código",type:"number",enableCellEdit:!1},{name:"title",displayName:"Descrição",enableCellEditOnFocus:!1,validators:{minLength:1,maxLength:255,required:!0},cellTemplate:"ui-grid/cellTitleValidator",cellTooltip:function(row,col){return row.entity.title}},{name:"complete",enableCellEditOnFocus:!1,displayName:"Tarefa completa",cellFilter:"mapComplete",type:"boolean"},{name:"createdAt",displayName:"Data da criação",type:"date",cellFilter:'date:"dd/MM/yyyy hh:mm"',enableCellEdit:!1},{name:"updatedAt",displayName:"Data da atualização",type:"date",cellFilter:'date:"dd/MM/yyyy hh:mm"',enableCellEdit:!1}],$scope.valoresEditados="",$scope.gridOptions.onRegisterApi=function(gridApi){($scope.gridApi=gridApi).edit.on.afterCellEdit($scope,function(rowEntity,colDef,newValue,oldValue){if(newValue!==oldValue){switch(colDef.name){case"title":0<newValue.length&&newValue.length<=255?($scope.alertaEdicao=!1,$scope.alertaExclusao=!0,$scope.alertaErro=!0,$scope.valoresExcluidos="",$http.put("todo/"+rowEntity.id,{title:newValue}).success(function(){$scope.valoresEditados='<table class="table"><thead><tr><th>Código</th><th>Coluna</th><th>Valor antigo</th><th>Valor novo</th></tr></thead><tbody><tr><td>'+rowEntity.id+"</td><td>"+colDef.displayName+"</td><td>"+oldValue+"</td><td>"+newValue+"</td></tr></tbody></table>"}).error(function(){$scope.valoresEditados="Erro na aplicação"})):($scope.alertaErro=!1,$scope.alertaEdicao=!0,$scope.alertaExclusao=!0,$scope.erros='<div class="panel-body">Erro ao editar o campo <b>'+colDef.displayName+"</b> ["+newValue.length+" caracteres] mínimo de 1 máximo de 255.</div>");break;case"complete":$http.put("todo/"+rowEntity.id,{complete:newValue})}$scope.$apply(),$scope.gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN)}})},$http.get("todo/all").success(function(data){$scope.gridOptions.data=data});var $aExclude=[];$scope.valoresExcluidos="",$scope.alertConfirm=!0,$scope.excluir=function(){var rowCol=$scope.gridApi.selection.getSelectedRows();0<rowCol.length&&($scope.valoresEditados="",$scope.alertaEdicao=!0,$scope.alertaErro=!0,$scope.alertaExclusao=!1,$scope.valoresExcluidos="",$scope.valoresExcluidos='<table class="table table-hover"><thead><tr><th>Código</th><th>Descrição</th></tr></thead><tbody>',angular.forEach(rowCol,function(value,key){$scope.valoresExcluidos+="<tr><td>"+value.id+"</td><td>"+value.title+"</td></tr>",$aExclude.push([value.id])}),$scope.valoresExcluidos+="</tbody></table>")},$scope.confirmarExclusao=function(){0<$aExclude.length&&(angular.forEach($aExclude,function(value,key){$http.delete("todo/"+value)}),location.reload())},$scope.cancelarExclusao=function(){location.reload()},$scope.closePanell=function(){$scope.alertaErro=!0,$scope.alertaEdicao=!0,$scope.alertaExclusao=!0}}]).filter("mapComplete",function(){return function(input){var msg="";switch(input){case!0:msg="Sim";break;case!1:msg="Não";break;default:msg="unknown"}return msg}})}(window.angular);